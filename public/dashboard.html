<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AI Report Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset and base styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: "Segoe UI", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
        }
        
        /* Navigation bar */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .brand {
            display: flex;
            align-items: center;
        }
        
        .brand a {
            color: #0078ff;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            align-items: center;
        }
        
        .nav-links a {
            margin-left: 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            color: #555;
            font-weight: 500;
        }
        
        .nav-links a.active,
        .nav-links a:hover {
            color: #0078ff;
        }
        
        .nav-links a i,
        .nav-links a svg {
            margin-right: 5px;
        }
        
        .right-links a {
            margin-left: 20px;
            color: #555;
        }
        
        /* Main content */
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
            color: #333;
        }
        
        /* Dashboard content */
        .dashboard-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 10px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
            color: #555;
            transition: background-color 0.3s;
        }
        
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background-color: #f0f7ff;
            color: #0078ff;
        }
        
        .sidebar-menu svg {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }
        
        /* Main dashboard area */
        .main-dashboard {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background-color: #fafafa;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
        }
        
        .upload-area:hover, .upload-area.drag-over {
            border-color: #0078ff;
            background-color: #f0f7ff;
        }
        
        .upload-area.uploading {
            border-color: #0078ff;
            background-color: #e0efff;
            pointer-events: none;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #0078ff;
            margin-bottom: 15px;
        }
        
        .upload-text h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .upload-text p {
            color: #666;
            margin-bottom: 20px;
        }
        
        /* Recent Reports */
        .reports-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .reports-header h2 {
            font-size: 1.5rem;
            color: #333;
        }
        
        .report-list {
            list-style: none;
        }
        
        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .report-info {
            display: flex;
            align-items: center;
        }
        
        .report-icon {
            width: 40px;
            height: 40px;
            background-color: #f0f7ff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .report-icon svg {
            color: #0078ff;
            width: 20px;
            height: 20px;
        }
        
        .report-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .report-date {
            font-size: 0.85rem;
            color: #888;
        }
        
        .report-status {
            font-size: 0.85rem;
            padding: 5px 10px;
            border-radius: 20px;
            background-color: #e6f4ea;
            color: #137333;
        }
        
        .report-status.pending {
            background-color: #fff8e6;
            color: #b06000;
        }
        
        /* Button styles */
        .btn {
            display: inline-block;
            background-color: #0078ff;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #0061cf;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid #0078ff;
            color: #0078ff;
        }
        
        .btn-outline:hover {
            background-color: #f0f7ff;
        }
        
        /* Icons */
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        
        /* Hide Admin and AI Assistant Elements */
        .right-links {
            display: none !important;
        }
        
        .ai-assistant {
            display: none !important;
        }
        
        /* AI Assistant Button (hidden) */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .ai-assistant span {
            background: #FFD700;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
        }
        
        /* ADDED: Analysis Results Section */
        .analysis-results {
            display: none;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .analysis-header h2 {
            margin: 0;
            color: #333;
        }
        
        .analysis-time {
            font-size: 0.85rem;
            color: #888;
        }
        
        .insight-list {
            margin: 20px 0;
        }
        
        .insight-item {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .metrics-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .metric-card {
            flex: 1;
            min-width: 120px;
            background-color: #f0f7ff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #0078ff;
            margin: 5px 0;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .recommendations {
            background-color: #f9f9f9;
            border-left: 4px solid #0078ff;
            padding: 15px;
            margin: 20px 0;
        }
        
        .recommendations h3 {
            margin-top: 0;
            color: #333;
        }
        
        .recommendations ul {
            margin: 10px 0 0 0;
            padding-left: 20px;
        }
        
        .recommendations li {
            margin-bottom: 8px;
        }
        
        .progress-container {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #0078ff;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 0.85rem;
            color: #666;
        }
        
        .file-info {
            background-color: #f0f7ff;
            border-radius: 5px;
            padding: 10px 15px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .file-info span {
            font-weight: 500;
        }

        .hidden {
            display: none;
        }
        
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        
        .tag {
            background-color: #e0efff;
            color: #0078ff;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeIn 0.5s forwards 1s;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .api-status i {
            font-size: 16px;
        }

        /* ADDED: Recent Documents Section */
        .recent-documents {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .recent-documents h3 {
            margin-top: 0;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .recent-documents h3 button {
            background-color: #f0f0f0;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            color: #333;
        }
        
        .recent-documents h3 button:hover {
            background-color: #e0e0e0;
        }
        
        .documents-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .document-item {
            display: flex;
            align-items: center;
            background-color: #f9f9f9;
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .document-item:hover {
            background-color: #f0f0f0;
        }
        
        .document-icon {
            background-color: #e0efff;
            color: #0078ff;
            width: 36px;
            height: 36px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }
        
        .document-info {
            flex: 1;
        }
        
        .document-name {
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .document-meta {
            font-size: 0.8rem;
            color: #666;
        }
        
        .document-link {
            display: inline-block;
            margin-left: 10px;
        }
        
        .empty-message {
            text-align: center;
            color: #666;
            padding: 30px 0;
            font-style: italic;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 20px 0;
            color: #666;
        }

        /* Add CSS for the analysis badge and view analysis link */
        .analysis-badge {
            background-color: #0078ff;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            margin-left: 8px;
            vertical-align: middle;
        }

        .view-analysis-link {
            display: inline-block;
            margin-left: 15px;
            color: #0078ff;
            text-decoration: none;
            font-size: 0.85rem;
        }

        .view-analysis-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="api-status">
        <i class="fas fa-check-circle"></i> Gemini AI Connected
    </div>
    <!-- Navigation Bar -->
    <nav>
        <div class="brand">
            <a href="index.html">AI Report Analyzer</a>
        </div>
        <div class="nav-links">
            <a href="index.html">
                <svg class="icon" fill="#555" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
                </svg>
                Home
            </a>
            <a href="dashboard.html" class="active">
                <svg class="icon" fill="#0078ff" viewBox="0 0 24 24">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"></path>
                </svg>
                Dashboard
            </a>
        </div>
        <div class="right-links" style="display: none;">
            <a href="#">
                <svg class="icon" fill="#555" viewBox="0 0 24 24">
                    <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path>
                </svg>
                Admin
            </a>
            <a href="#">
                <svg class="icon" fill="#555" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm0-4h-2V7h2v8z"></path>
                </svg>
            </a>
        </div>
    </nav>
    
    <!-- Main content -->
    <div class="container">
        <div class="dashboard-header">
            <h1>Dashboard</h1>
            <button class="btn">New Analysis</button>
        </div>
        
        <div class="dashboard-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li>
                        <a href="#" class="active">
                            <svg fill="#0078ff" viewBox="0 0 24 24">
                                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"></path>
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <svg fill="#555" viewBox="0 0 24 24">
                                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6z"></path>
                            </svg>
                            All Reports
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <svg fill="#555" viewBox="0 0 24 24">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
                            </svg>
                            Analytics
                        </a>
                    </li>
                    <li class="hidden">
                        <a href="#">
                            <svg fill="#555" viewBox="0 0 24 24">
                                <path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"></path>
                            </svg>
                            Saved Insights
                        </a>
                    </li>
                    <li class="hidden">
                        <a href="#">
                            <svg fill="#555" viewBox="0 0 24 24">
                                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"></path>
                            </svg>
                            Notifications
                        </a>
                    </li>
                    <li class="hidden">
                        <a href="#">
                            <svg fill="#555" viewBox="0 0 24 24">
                                <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path>
                            </svg>
                            Settings
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Main dashboard area -->
            <div class="main-dashboard">
                <!-- Upload Area -->
                <div class="upload-area">
                    <div class="upload-icon">
                        <svg fill="#0078ff" width="48" height="48" viewBox="0 0 24 24">
                            <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path>
                        </svg>
                    </div>
                    <div class="upload-text">
                        <h3>Upload Report</h3>
                        <p>Drag and drop your PDF, DOCX, or TXT files here, or click to browse</p>
                        <button class="btn" id="upload-button">Select File</button>
                        <input type="file" id="file-input" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                    </div>
                    <div class="progress-container" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                        <div class="progress-text">Uploading... 0%</div>
                    </div>
                </div>
                
                <!-- Analysis Results Section (Initially Hidden) -->
                <div class="analysis-results" style="display: none; background-color: white; border-radius: 8px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05); padding: 30px; margin-bottom: 30px;">
                    <div class="analysis-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <h2>Analysis Results</h2>
                        <span class="analysis-time" style="font-size: 0.85rem; color: #888;">Analyzed just now</span>
                    </div>
                    
                    <div class="file-info" style="background-color: #f0f7ff; border-radius: 5px; padding: 10px 15px; margin-top: 15px; font-size: 0.9rem;">
                        Analyzed: <span id="file-name">report.pdf</span> (<span id="file-size">1.2 MB</span>)
                    </div>
                    
                    <h3>Document Summary</h3>
                    <div id="document-summary" style="background-color: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; line-height: 1.5;"></div>
                    
                    <h3>Key Insights</h3>
                    <div id="insights-container"></div>
                    
                    <h3>Metrics</h3>
                    <div id="metrics-container" style="display: flex; flex-wrap: wrap; gap: 15px; margin: 25px 0;"></div>
                    
                    <div id="topics-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0;"></div>
                    
                    <div class="recommendations" style="background-color: #f9f9f9; border-left: 4px solid #0078ff; padding: 15px; margin: 20px 0;">
                        <h3>Recommendations</h3>
                        <ul id="recommendations-list"></ul>
                    </div>
                </div>
                
                <!-- Recent Documents Section (Replacing Recent Reports) -->
                <div class="recent-reports">
                    <div class="reports-header">
                        <h2>Recent Documents</h2>
                        <button id="refresh-documents" class="btn btn-outline">Refresh</button>
                    </div>
                    
                    <div id="documents-container">
                        <div class="loading-spinner">Loading documents...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Assistant Button -->
    <div class="ai-assistant" style="display: none;">
        <span>ðŸ¤–</span>
        <svg fill="white" width="24" height="24" viewBox="0 0 24 24">
            <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18z"></path>
        </svg>
        <svg fill="white" width="24" height="24" viewBox="0 0 24 24">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
        </svg>
    </div>
    
    <script>
        // Dashboard functionality
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Dashboard loaded successfully");
            
            const uploadArea = document.querySelector('.upload-area');
            const fileInput = document.getElementById('file-input');
            const uploadButton = document.getElementById('upload-button');
            const progressContainer = document.querySelector('.progress-container');
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-text');
            const analysisResults = document.querySelector('.analysis-results');
            const documentsContainer = document.getElementById('documents-container');
            const refreshDocumentsButton = document.getElementById('refresh-documents');
            const mainDashboardContainer = document.querySelector('.main-dashboard');
            const reportsHeader = document.querySelector('.reports-header h2');
            
            // Set up file upload event handlers
            if (uploadButton && fileInput) {
                // When the upload button is clicked, trigger the hidden file input
                uploadButton.addEventListener('click', function() {
                    fileInput.click();
                });
                
                // When a file is selected, handle the upload
                fileInput.addEventListener('change', function(e) {
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        uploadFile(file);
                    }
                });
                
                // Make the upload area support drag and drop
                if (uploadArea) {
                    uploadArea.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        uploadArea.classList.add('drag-over');
                    });
                    
                    uploadArea.addEventListener('dragleave', function() {
                        uploadArea.classList.remove('drag-over');
                    });
                    
                    uploadArea.addEventListener('drop', function(e) {
                        e.preventDefault();
                        uploadArea.classList.remove('drag-over');
                        
                        if (e.dataTransfer.files.length > 0) {
                            const file = e.dataTransfer.files[0];
                            uploadFile(file);
                        }
                    });
                }
            }
            
            // Function to handle file uploads
            function uploadFile(file) {
                // Show uploading state
                uploadArea.classList.add('uploading');
                progressContainer.style.display = 'block';
                progressFill.style.width = '0%';
                progressText.textContent = 'Uploading... 0%';
                
                const formData = new FormData();
                formData.append('file', file);
                
                const xhr = new XMLHttpRequest();
                
                // Track upload progress
                xhr.upload.addEventListener('progress', function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        progressFill.style.width = percentComplete + '%';
                        progressText.textContent = `Uploading... ${percentComplete}%`;
                    }
                });
                
                // Handle upload completion
                xhr.addEventListener('load', function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        console.log('File uploaded successfully');
                        progressText.textContent = 'Upload complete!';
                        
                        // Reset the file input
                        fileInput.value = '';
                        
                        // After a short delay, hide the progress bar and reset the upload area
                        setTimeout(function() {
                            uploadArea.classList.remove('uploading');
                            progressContainer.style.display = 'none';
                            
                            // Refresh the documents list
                            loadRecentDocuments();
                        }, 1500);
                    } else {
                        console.error('Upload failed');
                        progressText.textContent = 'Upload failed. Please try again.';
                        uploadArea.classList.remove('uploading');
                        
                        // After a delay, hide the progress bar
                        setTimeout(function() {
                            progressContainer.style.display = 'none';
                        }, 3000);
                    }
                });
                
                // Handle network errors
                xhr.addEventListener('error', function() {
                    console.error('Network error during upload');
                    progressText.textContent = 'Network error. Please try again.';
                    uploadArea.classList.remove('uploading');
                    
                    // After a delay, hide the progress bar
                    setTimeout(function() {
                        progressContainer.style.display = 'none';
                    }, 3000);
                });
                
                // Start the upload
                xhr.open('POST', '/api/upload', true);
                xhr.send(formData);
            }
            
            // Store all documents for use in "All Reports" view
            let allDocuments = [];
            let currentView = 'recent'; // 'recent' or 'all'
            
            // Get the New Analysis button in the header
            const newAnalysisButton = document.querySelector('.dashboard-header .btn');
            
            // Add click handler for the New Analysis button
            if (newAnalysisButton && uploadButton) {
                newAnalysisButton.addEventListener('click', function() {
                    // If we're in the analytics view, switch to dashboard view first
                    if (currentView === 'analytics') {
                        // Click the Dashboard link to switch to dashboard view
                        const dashboardLink = document.querySelector('.sidebar-menu li:nth-child(1) a');
                        if (dashboardLink) {
                            dashboardLink.click();
                        }
                        
                        // Set a small delay to ensure dashboard view is loaded
                        setTimeout(() => {
                            // Now focus on the upload area and trigger upload
                            uploadArea.scrollIntoView({ behavior: 'smooth' });
                            setTimeout(() => {
                                uploadButton.click();
                            }, 300);
                        }, 300);
                    } else {
                        // We're already in dashboard or all reports view
                        // Focus on the upload area
                        uploadArea.scrollIntoView({ behavior: 'smooth' });
                        
                        // Trigger the upload button click
                        setTimeout(() => {
                            uploadButton.click();
                        }, 300);
                    }
                });
            }
            
            // Set up sidebar navigation
            setupSidebarNavigation();
            
            // Load recent documents on page load
            loadRecentDocuments();
            
            // Refresh documents button handler
            if (refreshDocumentsButton) {
                refreshDocumentsButton.addEventListener('click', function() {
                    if (currentView === 'recent') {
                        loadRecentDocuments();
                    } else {
                        // If in "All Reports" view, refresh but stay in that view
                        loadAllDocuments();
                    }
                });
            }
            
            // Function to set up sidebar navigation
            function setupSidebarNavigation() {
                // Get the sidebar menu items
                const dashboardLink = document.querySelector('.sidebar-menu li:nth-child(1) a');
                const allReportsLink = document.querySelector('.sidebar-menu li:nth-child(2) a');
                const analyticsLink = document.querySelector('.sidebar-menu li:nth-child(3) a');
                const uploadArea = document.querySelector('.upload-area');
                
                // Set up click handler for All Reports link
                if (allReportsLink) {
                    allReportsLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Update the active class for sidebar items
                        document.querySelectorAll('.sidebar-menu a').forEach(link => {
                            link.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Update the header
                        if (reportsHeader) {
                            reportsHeader.textContent = "All Reports";
                        }
                        
                        // Hide upload area in All Reports view
                        if (uploadArea) {
                            uploadArea.style.display = 'none';
                        }
                        
                        // Hide analytics view if it exists
                        const analyticsView = document.querySelector('.analytics-view');
                        if (analyticsView) {
                            analyticsView.style.display = 'none';
                        }
                        
                        // Show documents container
                        documentsContainer.parentElement.style.display = 'block';
                        
                        // Switch to all documents view
                        currentView = 'all';
                        loadAllDocuments();
                    });
                }
                
                // Set up click handler for Dashboard link
                if (dashboardLink) {
                    dashboardLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Update the active class for sidebar items
                        document.querySelectorAll('.sidebar-menu a').forEach(link => {
                            link.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Update the header
                        if (reportsHeader) {
                            reportsHeader.textContent = "Recent Documents";
                        }
                        
                        // Show upload area in Dashboard view
                        if (uploadArea) {
                            uploadArea.style.display = 'block';
                        }
                        
                        // Hide analytics view if it exists
                        const analyticsView = document.querySelector('.analytics-view');
                        if (analyticsView) {
                            analyticsView.style.display = 'none';
                        }
                        
                        // Show documents container
                        documentsContainer.parentElement.style.display = 'block';
                        
                        // Switch to recent documents view
                        currentView = 'recent';
                        displayDocumentsList(allDocuments);
                    });
                }
                
                // Set up click handler for Analytics link
                if (analyticsLink) {
                    analyticsLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Update the active class for sidebar items
                        document.querySelectorAll('.sidebar-menu a').forEach(link => {
                            link.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Hide upload area in Analytics view
                        if (uploadArea) {
                            uploadArea.style.display = 'none';
                        }
                        
                        // Hide documents container
                        documentsContainer.parentElement.style.display = 'none';
                        
                        // Initialize or display analytics view
                        initializeAnalyticsView();
                        
                        // Current view is analytics
                        currentView = 'analytics';
                    });
                }
            }
            
            // Function to load all documents
            function loadAllDocuments() {
                console.log('Loading all documents...');
                documentsContainer.innerHTML = '<div class="loading-spinner">Loading all documents...</div>';
                
                // Add timeout for fetch operation
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
                
                // Fetch documents from the API
                fetch('/api/files', {
                    signal: controller.signal
                })
                    .then(response => {
                        clearTimeout(timeoutId);
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('All documents retrieved:', data);
                        
                        // Extra debugging
                        console.log('API response structure:', Object.keys(data));
                        console.log('Success flag:', data.success);
                        console.log('Message:', data.message);
                        console.log('Files array exists:', !!data.files);
                        console.log('Files array length:', data.files ? data.files.length : 0);
                        
                        if (data && data.files && Array.isArray(data.files)) {
                            allDocuments = data.files || [];
                            console.log('Sample first document:', allDocuments.length > 0 ? allDocuments[0] : 'No documents');
                            // Show all documents without limit
                            displayAllDocumentsList(allDocuments);
                        } else {
                            console.warn('API response missing files array or invalid format:', data);
                            documentsContainer.innerHTML = '<div class="empty-message">No documents found or invalid response format. Check browser console for details.</div>';
                        }
                    })
                    .catch(error => {
                        clearTimeout(timeoutId);
                        console.error('Error loading documents:', error);
                        documentsContainer.innerHTML = `<div class="empty-message">Error loading documents: ${error.message}. Please try again.</div>`;
                    });
            }
            
            // Function to load recent documents
            function loadRecentDocuments() {
                console.log('Loading recent documents...');
                documentsContainer.innerHTML = '<div class="loading-spinner">Loading documents...</div>';
                
                // Add timeout for fetch operation
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
                
                // Fetch documents from the API
                fetch('/api/files', {
                    signal: controller.signal
                })
                    .then(response => {
                        clearTimeout(timeoutId);
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Recent documents retrieved:', data);
                        
                        // Extra debugging
                        console.log('API response structure:', Object.keys(data));
                        console.log('Success flag:', data.success);
                        console.log('Message:', data.message);
                        console.log('Files array exists:', !!data.files);
                        console.log('Files array length:', data.files ? data.files.length : 0);
                        
                        if (data && data.files && Array.isArray(data.files)) {
                            allDocuments = data.files || [];
                            console.log('Sample first document:', allDocuments.length > 0 ? allDocuments[0] : 'No documents');
                            displayDocumentsList(allDocuments);
                        } else {
                            console.warn('API response missing files array or invalid format:', data);
                            documentsContainer.innerHTML = '<div class="empty-message">No documents found or invalid response format. Check browser console for details.</div>';
                        }
                    })
                    .catch(error => {
                        clearTimeout(timeoutId);
                        console.error('Error loading documents:', error);
                        documentsContainer.innerHTML = `<div class="empty-message">Error loading documents: ${error.message}. Please try again.</div>`;
                    });
            }
            
            // Function to load analysis for a specific document
            function loadAnalysisForDocument(documentId) {
                console.log('Loading analysis for document:', documentId);
                
                // Check if document ID is valid
                if (!documentId) {
                    console.error('Invalid document ID for analysis');
                    return;
                }
                
                // Format expected by the server is 'analysis-documentId'
                // For direct fetch, we add the 'analysis-' prefix to the documentId
                const analysisId = documentId.replace(/^analysis-/, '');
                
                // Show loading state in the analysis results section
                analysisResults.style.display = 'block';
                const documentSummary = document.getElementById('document-summary');
                const insightsContainer = document.getElementById('insights-container');
                const metricsContainer = document.getElementById('metrics-container');
                const recommendationsList = document.getElementById('recommendations-list');
                const fileName = document.getElementById('file-name');
                const fileSize = document.getElementById('file-size');
                
                documentSummary.innerHTML = '<div class="loading-spinner">Loading analysis...</div>';
                insightsContainer.innerHTML = '';
                metricsContainer.innerHTML = '';
                recommendationsList.innerHTML = '';
                
                // Find the document in our loaded documents
                const document = allDocuments.find(doc => doc.objectName === documentId);
                
                // Set the file name and size if document is found
                if (document) {
                    fileName.textContent = document.name || 'Unknown file';
                    fileSize.textContent = formatFileSize(document.size);
                } else {
                    fileName.textContent = documentId;
                    fileSize.textContent = 'Unknown size';
                }
                
                // Fetch the analysis directly from MinIO, using an API endpoint
                fetch(`/api/analysis?id=analysis-${analysisId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(response => {
                        // Check if the response is valid
                        if (!response.success) {
                            throw new Error(response.message || 'Failed to load analysis');
                        }
                        
                        try {
                            // Log the full response structure for debugging
                            console.log('Analysis API Response:', response);
                            
                            // Get the data object from the response
                            const data = response.data;
                            console.log('Analysis data object:', data);
                            console.log('Data structure keys:', Object.keys(data));
                            
                            // Get the actual analysis object - it can be nested in an 'analysis' property
                            // or can be directly in specific properties like 'summary', 'insights', etc.
                            // If analysis property exists, use that, otherwise use the data object itself
                            const analysisData = data.analysis || data;
                            console.log('Final analysis data to display:', analysisData);
                            console.log('Analysis data keys:', Object.keys(analysisData));
                            
                            // DISPLAY SUMMARY
                            if (analysisData.summary) {
                                console.log('Found summary:', analysisData.summary);
                                documentSummary.innerHTML = analysisData.summary;
                            } else {
                                console.warn('No summary found in analysis data');
                                documentSummary.innerHTML = 'No summary available';
                            }
                            
                            // DISPLAY INSIGHTS
                            // Check multiple possible property names for insights
                            const insights = analysisData.keyInsights || analysisData.insights || [];
                            console.log('Found insights:', insights);
                            
                            if (insights && insights.length > 0) {
                                const insightsList = document.createElement('ul');
                                insightsList.className = 'insight-list';
                                
                                insights.forEach(insight => {
                                    const insightItem = document.createElement('li');
                                    insightItem.className = 'insight-item';
                                    insightItem.textContent = insight;
                                    insightsList.appendChild(insightItem);
                                });
                                
                                insightsContainer.innerHTML = '';
                                insightsContainer.appendChild(insightsList);
                            } else {
                                insightsContainer.innerHTML = '<p>No insights available for this document.</p>';
                            }
                            
                            // DISPLAY METRICS
                            const metrics = analysisData.metrics || {};
                            console.log('Found metrics:', metrics);
                            
                            if (metrics && Object.keys(metrics).length > 0) {
                                metricsContainer.innerHTML = '';
                                
                                for (const [key, value] of Object.entries(metrics)) {
                                    const metricCard = document.createElement('div');
                                    metricCard.className = 'metric-card';
                                    
                                    metricCard.innerHTML = `
                                        <div class="metric-value">${value}</div>
                                        <div class="metric-label">${key}</div>
                                    `;
                                    
                                    metricsContainer.appendChild(metricCard);
                                }
                            } else {
                                metricsContainer.innerHTML = '<p>No metrics available for this document.</p>';
                            }
                            
                            // DISPLAY RECOMMENDATIONS
                            const recommendations = analysisData.recommendations || [];
                            console.log('Found recommendations:', recommendations);
                            
                            if (recommendations && recommendations.length > 0) {
                                recommendationsList.innerHTML = '';
                                
                                recommendations.forEach(recommendation => {
                                    const recommendationItem = document.createElement('li');
                                    recommendationItem.textContent = recommendation;
                                    recommendationsList.appendChild(recommendationItem);
                                });
                            } else {
                                recommendationsList.innerHTML = '<li>No recommendations available for this document.</li>';
                            }
                            
                            // FALLBACK: Display raw data if no structured content was found
                            const hasContent = analysisData.summary || 
                                             (insights && insights.length > 0) || 
                                             (Object.keys(metrics).length > 0) || 
                                             (recommendations && recommendations.length > 0);
                            
                            if (!hasContent) {
                                console.warn('No structured analysis data found, displaying raw data');
                                documentSummary.innerHTML = '<strong>Document Analysis (Raw Data):</strong><br><br>' + 
                                    '<pre style="white-space: pre-wrap; font-family: monospace; background: #f7f7f7; padding: 10px; border-radius: 5px;">' + 
                                    JSON.stringify(data, null, 2) + 
                                    '</pre>';
                            }
                        } catch (parseError) {
                            console.error('Error parsing analysis data:', parseError);
                            documentSummary.innerHTML = `<div class="error-message">Error parsing analysis data: ${parseError.message}</div>`;
                            insightsContainer.innerHTML = '';
                            metricsContainer.innerHTML = '';
                            recommendationsList.innerHTML = '';
                        }
                        
                        // Scroll to analysis results
                        analysisResults.scrollIntoView({ behavior: 'smooth' });
                    })
                    .catch(error => {
                        console.error('Error loading analysis:', error);
                        documentSummary.innerHTML = `<div class="error-message">Error loading analysis: ${error.message}</div>`;
                    });
            }
            
            // Helper function to format file size
            function formatFileSize(bytes) {
                if (!bytes || isNaN(bytes)) return 'Unknown size';
                
                const units = ['B', 'KB', 'MB', 'GB', 'TB'];
                let size = bytes;
                let unitIndex = 0;
                
                while (size >= 1024 && unitIndex < units.length - 1) {
                    size /= 1024;
                    unitIndex++;
                }
                
                return `${size.toFixed(1)} ${units[unitIndex]}`;
            }
            
            // Function to initialize or display the analytics view
            function initializeAnalyticsView() {
                // Check if analytics view already exists
                let analyticsView = document.querySelector('.analytics-view');
                
                // If analytics view doesn't exist, create it
                if (!analyticsView) {
                    analyticsView = document.createElement('div');
                    analyticsView.className = 'analytics-view';
                    analyticsView.style.backgroundColor = 'white';
                    analyticsView.style.borderRadius = '8px';
                    analyticsView.style.boxShadow = '0 3px 10px rgba(0, 0, 0, 0.05)';
                    analyticsView.style.padding = '30px';
                    analyticsView.style.marginBottom = '30px';
                    
                    // Create analytics content
                    analyticsView.innerHTML = `
                        <div class="analytics-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                            <h2>Analytics Dashboard</h2>
                            <button id="refresh-analytics" class="btn btn-outline">Refresh Data</button>
                        </div>
                        
                        <div class="analytics-overview" style="margin-bottom: 30px;">
                            <h3>Documents Overview</h3>
                            <div class="analytics-cards" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                                <div class="analytics-card" style="flex: 1; min-width: 200px; background-color: #f0f7ff; border-radius: 8px; padding: 20px; text-align: center;">
                                    <div class="card-value" style="font-size: 2.5rem; font-weight: bold; color: #0078ff; margin: 10px 0;" id="total-documents">0</div>
                                    <div class="card-label" style="color: #666; font-size: 0.9rem;">Total Documents</div>
                                </div>
                                <div class="analytics-card" style="flex: 1; min-width: 200px; background-color: #f0fff7; border-radius: 8px; padding: 20px; text-align: center;">
                                    <div class="card-value" style="font-size: 2.5rem; font-weight: bold; color: #00c853; margin: 10px 0;" id="analyzed-documents">0</div>
                                    <div class="card-label" style="color: #666; font-size: 0.9rem;">Analyzed Documents</div>
                                </div>
                                <div class="analytics-card" style="flex: 1; min-width: 200px; background-color: #fff8f0; border-radius: 8px; padding: 20px; text-align: center;">
                                    <div class="card-value" style="font-size: 2.5rem; font-weight: bold; color: #ff9800; margin: 10px 0;" id="pending-documents">0</div>
                                    <div class="card-label" style="color: #666; font-size: 0.9rem;">Pending Analysis</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="analytics-types" style="margin-bottom: 30px;">
                            <h3>Document Types</h3>
                            <div class="document-types" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px;">
                                <div class="document-type" style="flex: 1; min-width: 150px; background-color: #f9f9f9; border-radius: 8px; padding: 15px; display: flex; align-items: center;">
                                    <div style="background-color: #e3f2fd; padding: 10px; border-radius: 50%; margin-right: 15px;">
                                        <svg fill="#0078ff" width="24" height="24" viewBox="0 0 24 24">
                                            <path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div style="font-weight: 500;">PDF Documents</div>
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #0078ff;" id="pdf-count">0</div>
                                    </div>
                                </div>
                                <div class="document-type" style="flex: 1; min-width: 150px; background-color: #f9f9f9; border-radius: 8px; padding: 15px; display: flex; align-items: center;">
                                    <div style="background-color: #e8f5e9; padding: 10px; border-radius: 50%; margin-right: 15px;">
                                        <svg fill="#00c853" width="24" height="24" viewBox="0 0 24 24">
                                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM8 4h1v5H8V4zm3 0h1v5h-1V4zm3 0h1v5h-1V4zm-6 6h8v1H8v-1zm0 2h8v1H8v-1zm0 2h8v1H8v-1z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div style="font-weight: 500;">Word Documents</div>
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #00c853;" id="word-count">0</div>
                                    </div>
                                </div>
                                <div class="document-type" style="flex: 1; min-width: 150px; background-color: #f9f9f9; border-radius: 8px; padding: 15px; display: flex; align-items: center;">
                                    <div style="background-color: #fff3e0; padding: 10px; border-radius: 50%; margin-right: 15px;">
                                        <svg fill="#ff9800" width="24" height="24" viewBox="0 0 24 24">
                                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <div style="font-weight: 500;">Other Files</div>
                                        <div style="font-size: 1.5rem; font-weight: bold; color: #ff9800;" id="other-count">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="analytics-activity" style="margin-bottom: 30px;">
                            <h3>Recent Activity</h3>
                            <div class="recent-activity" style="margin-top: 20px; background-color: #f9f9f9; border-radius: 8px; padding: 20px;" id="recent-activity">
                                <div class="loading-spinner">Loading analytics data...</div>
                            </div>
                        </div>
                    `;
                    
                    // Add analytics view to the main dashboard
                    mainDashboardContainer.appendChild(analyticsView);
                    
                    // Add event listener for refresh analytics button
                    const refreshAnalyticsButton = analyticsView.querySelector('#refresh-analytics');
                    if (refreshAnalyticsButton) {
                        refreshAnalyticsButton.addEventListener('click', function() {
                            loadAnalyticsData();
                        });
                    }
                } else {
                    // If it exists, make it visible
                    analyticsView.style.display = 'block';
                }
                
                // Load analytics data
                loadAnalyticsData();
            }
            
            // Function to load analytics data
            function loadAnalyticsData() {
                console.log('Loading analytics data...');
                
                // Set loading state for activity section
                const recentActivity = document.getElementById('recent-activity');
                if (recentActivity) {
                    recentActivity.innerHTML = '<div class="loading-spinner">Loading analytics data...</div>';
                }
                
                // Add timeout for fetch operation
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
                
                // Fetch documents from the API
                fetch('/api/files', {
                    signal: controller.signal
                })
                    .then(response => {
                        clearTimeout(timeoutId);
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Analytics data retrieved:', data);
                        if (data && data.files) {
                            // Update analytics visualization
                            updateAnalyticsVisualization(data.files);
                        } else {
                            console.warn('API response missing files array:', data);
                            updateAnalyticsVisualization([]);
                        }
                    })
                    .catch(error => {
                        clearTimeout(timeoutId);
                        console.error('Error loading analytics data:', error);
                        const recentActivity = document.getElementById('recent-activity');
                        if (recentActivity) {
                            recentActivity.innerHTML = '<div class="empty-message">Error loading analytics data. Please try again.</div>';
                        }
                    });
            }
            
            // Function to update analytics visualization
            function updateAnalyticsVisualization(documents) {
                // Count totals
                const totalDocuments = documents.length;
                const analyzedDocuments = documents.filter(doc => doc.hasAnalysis).length;
                const pendingDocuments = totalDocuments - analyzedDocuments;
                
                // Update document counts
                document.getElementById('total-documents').textContent = totalDocuments;
                document.getElementById('analyzed-documents').textContent = analyzedDocuments;
                document.getElementById('pending-documents').textContent = pendingDocuments;
                
                // Count document types
                let pdfCount = 0;
                let wordCount = 0;
                let otherCount = 0;
                
                documents.forEach(doc => {
                    if (doc.name) {
                        const extension = doc.name.split('.').pop().toLowerCase();
                        if (extension === 'pdf') {
                            pdfCount++;
                        } else if (['doc', 'docx'].includes(extension)) {
                            wordCount++;
                        } else {
                            otherCount++;
                        }
                    } else {
                        otherCount++;
                    }
                });
                
                // Update document type counts
                document.getElementById('pdf-count').textContent = pdfCount;
                document.getElementById('word-count').textContent = wordCount;
                document.getElementById('other-count').textContent = otherCount;
                
                // Update recent activity
                const recentActivity = document.getElementById('recent-activity');
                if (recentActivity) {
                    if (documents.length === 0) {
                        recentActivity.innerHTML = '<div class="empty-message">No documents found. Upload documents to view analytics.</div>';
                        return;
                    }
                    
                    // Sort documents by upload date (newest first)
                    const sortedDocuments = [...documents].sort((a, b) => {
                        const dateA = a.lastModified ? new Date(a.lastModified) : new Date(0);
                        const dateB = b.lastModified ? new Date(b.lastModified) : new Date(0);
                        return dateB - dateA;
                    });
                    
                    // Take the 5 most recent documents
                    const recentDocuments = sortedDocuments.slice(0, 5);
                    
                    // Create activity list
                    const activityList = document.createElement('ul');
                    activityList.style.listStyle = 'none';
                    activityList.style.padding = '0';
                    
                    recentDocuments.forEach(doc => {
                        const date = doc.lastModified ? new Date(doc.lastModified) : new Date();
                        const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                        
                        const listItem = document.createElement('li');
                        listItem.style.padding = '10px 0';
                        listItem.style.borderBottom = '1px solid #eee';
                        listItem.style.display = 'flex';
                        listItem.style.alignItems = 'center';
                        listItem.style.justifyContent = 'space-between';
                        
                        // Determine icon based on file type
                        let iconColor = '#0078ff';
                        if (doc.name) {
                            const extension = doc.name.split('.').pop().toLowerCase();
                            if (extension === 'pdf') {
                                iconColor = '#0078ff';
                            } else if (['doc', 'docx'].includes(extension)) {
                                iconColor = '#00c853';
                            } else {
                                iconColor = '#ff9800';
                            }
                        }
                        
                        listItem.innerHTML = `
                            <div style="display: flex; align-items: center;">
                                <div style="background-color: ${iconColor}1a; padding: 8px; border-radius: 50%; margin-right: 15px;">
                                    <i class="fas fa-file" style="color: ${iconColor};"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">${doc.name || 'Unnamed document'}</div>
                                    <div style="font-size: 0.8rem; color: #666;">Uploaded ${formattedDate}</div>
                                </div>
                            </div>
                            <div>
                                ${doc.hasAnalysis ? 
                                    '<span style="background-color: #e8f5e9; color: #00c853; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">Analyzed</span>' : 
                                    '<span style="background-color: #fff8e1; color: #ff9800; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">Pending</span>'}
                            </div>
                        `;
                        
                        activityList.appendChild(listItem);
                    });
                    
                    recentActivity.innerHTML = '';
                    recentActivity.appendChild(activityList);
                }
            }
            
            // Function to display only the 5 latest documents on the dashboard
            function displayDocumentsList(documents) {
                console.log('Displaying recent documents list:', documents);
                console.log('Documents array type:', Object.prototype.toString.call(documents));
                console.log('Documents count:', documents.length);
                
                if (!documents || !Array.isArray(documents)) {
                    console.error('Invalid documents array:', documents);
                    documentsContainer.innerHTML = '<div class="empty-message">Error: Invalid document data format. Check browser console.</div>';
                    return;
                }
                
                if (documents.length === 0) {
                    documentsContainer.innerHTML = '<div class="empty-message">No documents found. Upload a document to get started.</div>';
                    return;
                }
                
                // Display debugging info at the top
                documentsContainer.innerHTML = `
                    <div style="background-color: #f7f7f7; padding: 10px; margin-bottom: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;">
                        <div>Debug: Found ${documents.length} document(s)</div>
                        <div>First document: ${documents[0] ? documents[0].name : 'unknown'}</div>
                        <div>Object name: ${documents[0] ? documents[0].objectName : 'unknown'}</div>
                    </div>
                `;
                
                // Store the total count of documents
                const totalCount = documents.length;
                
                // Ensure we can sort by testing a document first
                if (documents.length > 0) {
                    console.log('Sample document for sorting:', documents[0]);
                    console.log('Sample lastModified:', documents[0].lastModified);
                }
                
                // Sort documents by upload date (newest first)
                const sortedDocuments = [...documents].sort((a, b) => {
                    const dateA = a.lastModified ? new Date(a.lastModified) : new Date(0);
                    const dateB = b.lastModified ? new Date(b.lastModified) : new Date(0);
                    return dateB - dateA;
                });
                
                // Only show the 5 latest documents
                const recentDocuments = sortedDocuments.slice(0, 5);
                
                const documentsList = document.createElement('ul');
                documentsList.className = 'report-list';
                
                // Add a message when we have more than 5 documents
                if (totalCount > 5) {
                    const messageItem = document.createElement('div');
                    messageItem.className = 'documents-message';
                    messageItem.innerHTML = `
                        <div style="background-color: #f0f7ff; border-radius: 5px; padding: 10px 15px; margin-bottom: 15px; font-size: 0.9rem; color: #333;">
                            Showing 5 most recent documents of ${totalCount} total.
                            <a href="#" class="view-all-link" style="color: #0078ff; text-decoration: none; font-weight: 500; margin-left: 10px;">
                                View all reports <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    `;
                    
                    // Add click handler for the "View all reports" link
                    messageItem.querySelector('.view-all-link').addEventListener('click', function(e) {
                        e.preventDefault();
                        // Click the All Reports sidebar link
                        document.querySelector('.sidebar-menu li:nth-child(2) a').click();
                    });
                    
                    documentsList.appendChild(messageItem);
                }
                
                recentDocuments.forEach(doc => {
                    // Determine icon based on file type
                    let iconPath = '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6z"></path>';
                    
                    if (doc.name) {
                        const extension = doc.name.split('.').pop().toLowerCase();
                        if (['pdf'].includes(extension)) {
                            iconPath = '<path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"></path>';
                        } else if (['doc', 'docx'].includes(extension)) {
                            iconPath = '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM8 4h1v5H8V4zm3 0h1v5h-1V4zm3 0h1v5h-1V4zm-6 6h8v1H8v-1zm0 2h8v1H8v-1zm0 2h8v1H8v-1z"></path>';
                        }
                    }
                    
                    // Format the date
                    const date = doc.lastModified ? new Date(doc.lastModified) : new Date();
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    
                    // Create list item
                    const documentItem = document.createElement('li');
                    documentItem.className = 'report-item';
                    
                    // Analysis badge if available
                    const analysisBadge = doc.hasAnalysis 
                        ? '<span class="report-status">Analyzed</span>'
                        : '<span class="report-status pending">No Analysis</span>';
                    
                    documentItem.innerHTML = `
                        <div class="report-info">
                            <div class="report-icon">
                                <svg fill="#0078ff" viewBox="0 0 24 24">
                                    ${iconPath}
                                </svg>
                            </div>
                            <div>
                                <div class="report-name">${doc.name || 'Unnamed document'}</div>
                                <div class="report-date">Uploaded ${formattedDate}</div>
                                <div class="report-actions" style="margin-top: 5px;">
                                    <a href="/api/download?id=${doc.objectName}" target="_blank" class="document-link" title="Download document" style="color: #0078ff; font-size: 0.85rem; margin-right: 15px;">
                                        <i class="fas fa-download"></i> Download
                                    </a>
                                    ${doc.hasAnalysis ? `<a href="#" class="view-analysis-link" data-id="${doc.objectName}" title="View analysis" style="color: #0078ff; font-size: 0.85rem;">
                                        <i class="fas fa-chart-line"></i> View Analysis
                                    </a>` : ''}
                                </div>
                            </div>
                        </div>
                        ${analysisBadge}
                    `;
                    
                    // Add event listener for "View Analysis" link
                    if (doc.hasAnalysis) {
                        const viewAnalysisLink = documentItem.querySelector('.view-analysis-link');
                        viewAnalysisLink.addEventListener('click', function(e) {
                            e.preventDefault();
                            loadAnalysisForDocument(doc.objectName);
                        });
                    }
                    
                    documentsList.appendChild(documentItem);
                });
                
                documentsContainer.innerHTML = '';
                documentsContainer.appendChild(documentsList);
            }
            
            // Function to display all documents without limit
            function displayAllDocumentsList(documents) {
                console.log('Displaying all documents list:', documents);
                
                if (documents.length === 0) {
                    documentsContainer.innerHTML = '<div class="empty-message">No documents found. Upload a document to get started.</div>';
                    return;
                }
                
                const documentsList = document.createElement('ul');
                documentsList.className = 'report-list';
                
                // Add a message about the total number of documents
                const messageItem = document.createElement('div');
                messageItem.className = 'documents-message';
                messageItem.innerHTML = `
                    <div style="background-color: #f0f7ff; border-radius: 5px; padding: 10px 15px; margin-bottom: 15px; font-size: 0.9rem; color: #333;">
                        Showing all ${documents.length} documents.
                        <a href="#" class="back-to-recent-link" style="color: #0078ff; text-decoration: none; font-weight: 500; margin-left: 10px;">
                            <i class="fas fa-arrow-left"></i> Back to recent documents
                        </a>
                    </div>
                `;
                
                // Add click handler for the "Back to recent documents" link
                messageItem.querySelector('.back-to-recent-link').addEventListener('click', function(e) {
                    e.preventDefault();
                    // Navigate back to dashboard/recent view
                    document.querySelector('.sidebar-menu li:nth-child(1) a').click();
                });
                
                documentsList.appendChild(messageItem);
                
                documents.forEach(doc => {
                    // The same document item creation code from displayDocumentsList
                    // Determine icon based on file type
                    let iconPath = '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6z"></path>';
                    
                    if (doc.name) {
                        const extension = doc.name.split('.').pop().toLowerCase();
                        if (['pdf'].includes(extension)) {
                            iconPath = '<path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"></path>';
                        } else if (['doc', 'docx'].includes(extension)) {
                            iconPath = '<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM8 4h1v5H8V4zm3 0h1v5h-1V4zm3 0h1v5h-1V4zm-6 6h8v1H8v-1zm0 2h8v1H8v-1zm0 2h8v1H8v-1z"></path>';
                        }
                    }
                    
                    // Format the date
                    const date = doc.lastModified ? new Date(doc.lastModified) : new Date();
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    
                    // Create list item
                    const documentItem = document.createElement('li');
                    documentItem.className = 'report-item';
                    
                    // Analysis badge if available
                    const analysisBadge = doc.hasAnalysis 
                        ? '<span class="report-status">Analyzed</span>'
                        : '<span class="report-status pending">No Analysis</span>';
                    
                    documentItem.innerHTML = `
                        <div class="report-info">
                            <div class="report-icon">
                                <svg fill="#0078ff" viewBox="0 0 24 24">
                                    ${iconPath}
                                </svg>
                            </div>
                            <div>
                                <div class="report-name">${doc.name || 'Unnamed document'}</div>
                                <div class="report-date">Uploaded ${formattedDate}</div>
                                <div class="report-actions" style="margin-top: 5px;">
                                    <a href="/api/download?id=${doc.objectName}" target="_blank" class="document-link" title="Download document" style="color: #0078ff; font-size: 0.85rem; margin-right: 15px;">
                                        <i class="fas fa-download"></i> Download
                                    </a>
                                    ${doc.hasAnalysis ? `<a href="#" class="view-analysis-link" data-id="${doc.objectName}" title="View analysis" style="color: #0078ff; font-size: 0.85rem;">
                                        <i class="fas fa-chart-line"></i> View Analysis
                                    </a>` : ''}
                                </div>
                            </div>
                        </div>
                        ${analysisBadge}
                    `;
                    
                    // Add event listener for "View Analysis" link
                    if (doc.hasAnalysis) {
                        const viewAnalysisLink = documentItem.querySelector('.view-analysis-link');
                        viewAnalysisLink.addEventListener('click', function(e) {
                            e.preventDefault();
                            loadAnalysisForDocument(doc.objectName);
                        });
                    }
                    
                    documentsList.appendChild(documentItem);
                });
                
                documentsContainer.innerHTML = '';
                documentsContainer.appendChild(documentsList);
            }
        });
    </script>
</body>
</html> 